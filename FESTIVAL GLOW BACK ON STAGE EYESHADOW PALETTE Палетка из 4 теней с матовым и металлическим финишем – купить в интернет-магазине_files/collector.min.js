(()=>{function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.period=e,this.version="0.1.2",this.url="https://js-collector.icewood.net/collect",this.timeout=5e3,this.delay=200,this.storageKey="_collector_send_time"}var n,r,o;return n=t,(r=[{key:"getData",value:function(){var e=performance.timing;if(0===e.loadEventEnd)return!1;var t=e.navigationStart;return{dns:e.domainLookupEnd-e.domainLookupStart,connect:e.connectEnd-e.connectStart,request:e.responseStart-e.requestStart,response:e.responseEnd-e.responseStart,load:e.loadEventEnd-t,dom_ready:e.domContentLoadedEventEnd-t,dom_interactive:e.domInteractive-t,html_parse:e.domInteractive-e.domLoading,redirect:e.redirectEnd-e.redirectStart,domain:location.hostname,url:location.pathname,query:location.search,user_agent:navigator.userAgent,full_info:JSON.stringify(e)}}},{key:"rememberSendTime",value:function(){var e=this.getTimestamp();localStorage.setItem(this.storageKey,e.toString())}},{key:"success",value:function(e){if(200!==e.status)this.showError("Ошибка при запросе, статус: "+e.status);else{this.rememberSendTime();var t=(performance.now()-this.start)/1e3;console.log("Время выполнения (секунд): ".concat(t.toFixed(4)))}}},{key:"send",value:function(e){var t=this,n=JSON.stringify(e),r=new XMLHttpRequest;r.open("POST",this.url),r.responseType="json",r.timeout=this.timeout,r.addEventListener("load",(function(e){t.success(r)})),r.addEventListener("error",(function(e){t.showError("Ошибка при запросе, сетевая проблема")})),r.addEventListener("timeout",(function(e){t.showError("Ошибка при запросе, таймаут запроса")})),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(n)}},{key:"getTimestamp",value:function(){return Math.floor(Date.now()/1e3)}},{key:"canRun",value:function(){var e=this.getTimestamp(),t=localStorage.getItem(this.storageKey);null===t&&(t=0);var n=e-t;return!(n<=this.period&&(console.log("Отправка была недавно, ничего не делаем ("+n+" секунд назад)"),1))}},{key:"run",value:function(){try{if(this.start=performance.now(),!this.canRun())return;var e=this.getData();if(!1===e)return void console.error("Ошибка при получении данных, не отправляем их");this.send(e)}catch(e){this.showError(e.message)}}},{key:"showError",value:function(e){console.error("Ошибка при запросе: "+e)}},{key:"addEvent",value:function(){if("complete"!==document.readyState){var e=this;window.addEventListener("load",(function(){setTimeout((function(){e.run()}),e.delay)}))}else this.run()}}])&&e(n.prototype,r),o&&e(n,o),t}();new t(15).addEvent()})();